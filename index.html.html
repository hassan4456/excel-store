<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>متجر ملفات Excel - نسخة محلية</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* بعض التخصيصات للعرض بالعربي */
    body { font-family: 'Helvetica Neue', Arial, sans-serif; }
    .card-hover:hover { transform: translateY(-6px); box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  <header class="bg-gray-800/70 backdrop-blur sticky top-0 z-40">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <h1 class="text-xl font-semibold">متجر ملفات Excel</h1>
        <nav class="text-sm opacity-80 space-x-3">
          <a href="#" class="hover:underline">الرئيسية</a>
          <a href="#admin" class="hover:underline">لوحة التحكم</a>
        </nav>
      </div>
      <div class="flex items-center gap-3">
        <button id="btn-import" class="px-3 py-1 rounded-lg bg-gray-700/60 hover:bg-gray-700">استيراد عينات</button>
        <span class="text-xs opacity-70">الوضع: <strong class="ml-1">داكن</strong></span>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-6">

    <!-- LIST PAGE -->
    <section id="page-home" class="space-y-6">
      <div class="flex items-center justify-between">
        <h2 class="text-2xl font-bold">المنتجات</h2>
        <div class="text-sm opacity-80">اضغط على أي بطاقة لعرض الصفحة الخاصة بالمنتج</div>
      </div>

      <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <!-- PRODUCT DETAIL PAGE -->
    <section id="page-product" class="hidden">
      <button id="back-home" class="mb-4 px-3 py-1 rounded bg-gray-700/50">رجوع</button>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="md:col-span-2 bg-gray-800 p-6 rounded">
          <img id="prod-image" src="" alt="" class="w-full h-64 object-contain rounded bg-gray-900/40" />
          <h3 id="prod-name" class="text-xl font-semibold mt-4"></h3>
          <p id="prod-desc" class="mt-2 text-sm opacity-80"></p>
        </div>
        <aside class="bg-gray-800 p-6 rounded flex flex-col gap-4">
          <div class="text-lg">السعر: <strong id="prod-price"></strong></div>
          <div id="prod-action" class="mt-2"></div>
          <div class="text-xs opacity-70">شارك المنتج:</div>
          <div class="flex gap-2">
            <button id="copy-link" class="px-3 py-2 rounded bg-gray-700/60">نسخ رابط المنتج</button>
            <a id="open-wa" class="hidden px-3 py-2 rounded bg-green-600" target="_blank">فتح واتساب</a>
          </div>
        </aside>
      </div>
    </section>

    <!-- ADMIN PAGE -->
    <section id="page-admin" class="hidden">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold">لوحة التحكم</h2>
        <div class="text-sm opacity-70">التعديلات تخزن محليًا في المتصفح (localStorage)</div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- form -->
        <form id="admin-form" class="lg:col-span-1 bg-gray-800 p-4 rounded space-y-3">
          <h3 class="font-semibold">إضافة / تعديل منتج</h3>
          <input id="field-id" type="hidden" />
          <label class="block text-sm">الاسم<input id="field-name" class="w-full mt-1 p-2 rounded bg-gray-900 text-sm"/></label>
          <label class="block text-sm">الوصف<input id="field-desc" class="w-full mt-1 p-2 rounded bg-gray-900 text-sm"/></label>
          <label class="block text-sm">رابط الصورة<input id="field-img" class="w-full mt-1 p-2 rounded bg-gray-900 text-sm" placeholder="ضع رابط صورة أو اتركها فارغة"/></label>
          <label class="block text-sm">نوع المنتج
            <select id="field-type" class="w-full mt-1 p-2 rounded bg-gray-900 text-sm">
              <option value="free">مجاني</option>
              <option value="paid">مدفوع</option>
            </select>
          </label>
          <label class="block text-sm">السعر (مثال: 50 جنيه)<input id="field-price" class="w-full mt-1 p-2 rounded bg-gray-900 text-sm"/></label>
          <label class="block text-sm">رابط التحميل (إن كان مجاني)<input id="field-download" class="w-full mt-1 p-2 rounded bg-gray-900 text-sm" placeholder="files/example.xlsx"/></label>
          <label class="block text-sm">رابط واتساب (للمبيعات) <input id="field-wa" class="w-full mt-1 p-2 rounded bg-gray-900 text-sm" placeholder="https://wa.me/201234567890?text=..."/></label>
          <div class="flex gap-2">
            <button type="submit" class="px-3 py-2 rounded bg-blue-600">حفظ</button>
            <button id="clear-form" type="button" class="px-3 py-2 rounded bg-gray-700/60">إفراغ</button>
          </div>
        </form>

        <!-- table -->
        <div class="lg:col-span-2 bg-gray-800 p-4 rounded">
          <h3 class="font-semibold mb-3">قائمة المنتجات</h3>
          <div id="admin-list" class="space-y-3"></div>
          <div class="mt-4 text-xs opacity-70">ملاحظة: هذه الواجهة تعمل محليًا. لتثبيت الملفات (التحميل الفعلي) ضع ملفات Excel في نفس مجلد الملف HTML وعدل حقل "رابط التحميل" ليشير إليها.</div>
        </div>
      </div>
    </section>

  </main>

  <footer class="max-w-6xl mx-auto p-6 text-center text-xs opacity-60">
    مصمم بواسطة النظام المحلي — يعمل بدون استضافة. احفظ هذا الملف كـ <strong>index.html</strong> وافتحه في المتصفح.
  </footer>

<script>
// ---------- بيانات افتراضية ----------
const SAMPLE = [
  {
    id: 1,
    name: "كشف حضور وانصراف",
    price: "مجاني",
    type: "free",
    image: "https://images.unsplash.com/photo-1581091870622-3e1b3d8f5f14?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=000",
    description: "نموذج Excel لتسجيل الحضور والانصراف للموظفين.",
    download: "files/attendance.xlsx",
    whatsapp: ""
  },
  {
    id: 2,
    name: "برنامج المرتبات",
    price: "50 جنيه",
    type: "paid",
    image: "https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=000",
    description: "نظام شامل لحساب المرتبات مع الخصومات والمكافآت.",
    download: "",
    whatsapp: "https://wa.me/201234567890?text=مرحبًا%20أريد%20شراء%20برنامج%20المرتبات"
  }
];

// ---------- مساعدة التخزين ----------
const STORAGE_KEY = 'excel_store_products_v1';
function loadProducts(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) { localStorage.setItem(STORAGE_KEY, JSON.stringify(SAMPLE)); return SAMPLE; }
  try { return JSON.parse(raw); } catch(e){ localStorage.setItem(STORAGE_KEY, JSON.stringify(SAMPLE)); return SAMPLE; }
}
function saveProducts(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

let products = loadProducts();

// ---------- رندر البطاقات ----------
function renderList(){
  const grid = document.getElementById('products-grid'); grid.innerHTML='';
  products.forEach(p=>{
    if(p.hidden) return; // لو مخفي
    const card = document.createElement('div');
    card.className = 'card-hover bg-gray-800 p-4 rounded transition transform cursor-pointer';
    card.innerHTML = `
      <img src="${p.image||'https://via.placeholder.com/600x400?text=No+Image'}" alt="" class="w-full h-40 object-cover rounded" />
      <h4 class="mt-3 font-semibold">${p.name}</h4>
      <div class="mt-2 text-sm opacity-75">${p.description||''}</div>
      <div class="mt-3 flex items-center justify-between">
        <div class="text-sm">${p.type==='free'?'<span class="text-green-400">مجانًا</span>':'<span class="text-yellow-300">مدفوع</span>'}</div>
        <div class="text-sm font-medium">${p.price||''}</div>
      </div>
    `;
    card.addEventListener('click', ()=>{
      location.hash = 'product='+p.id;
    });
    grid.appendChild(card);
  });
}

// ---------- صفحة المنتج ----------
function showProductById(id){
  const p = products.find(x=>x.id==id);
  if(!p) { alert('المنتج غير موجود'); location.hash=''; return; }
  document.getElementById('page-home').classList.add('hidden');
  document.getElementById('page-admin').classList.add('hidden');
  document.getElementById('page-product').classList.remove('hidden');
  document.getElementById('prod-image').src = p.image || 'https://via.placeholder.com/800x600?text=No+Image';
  document.getElementById('prod-name').textContent = p.name;
  document.getElementById('prod-desc').textContent = p.description || '';
  document.getElementById('prod-price').textContent = p.price || '';

  const action = document.getElementById('prod-action'); action.innerHTML='';
  if(p.type==='free'){
    const a = document.createElement('a');
    a.href = p.download || '#';
    a.className = 'block px-4 py-2 rounded bg-green-600 text-center';
    a.textContent = 'تحميل مباشر';
    a.setAttribute('download','');
    action.appendChild(a);
  } else {
    const btn = document.createElement('a');
    btn.href = p.whatsapp || '#';
    btn.target = '_blank';
    btn.className = 'block px-4 py-2 rounded bg-yellow-500 text-black text-center';
    btn.textContent = p.whatsapp? ('تواصل عبر واتساب — ' + (p.price||'')) : 'اطلب عبر واتساب';
    action.appendChild(btn);
  }

  // whatsapp open link for quick access
  const openWa = document.getElementById('open-wa');
  if(p.whatsapp){ openWa.href = p.whatsapp; openWa.classList.remove('hidden'); } else openWa.classList.add('hidden');

  // copy link
  document.getElementById('copy-link').onclick = ()=>{
    const link = location.href.split('#')[0] + '#product='+p.id;
    navigator.clipboard.writeText(link).then(()=> alert('تم نسخ الرابط'));
  }
}

// ---------- عرض وإخفاء صفحات حسب الهَمَش ----------
function showHome(){
  document.getElementById('page-home').classList.remove('hidden');
  document.getElementById('page-product').classList.add('hidden');
  document.getElementById('page-admin').classList.add('hidden');
}
function showAdmin(){
  document.getElementById('page-home').classList.add('hidden');
  document.getElementById('page-product').classList.add('hidden');
  document.getElementById('page-admin').classList.remove('hidden');
  renderAdminList();
  fillFormEmpty();
}

function handleHash(){
  const h = location.hash.replace('#','');
  if(!h) { showHome(); renderList(); return; }
  if(h.startsWith('product=')){ const id = h.split('=')[1]; showProductById(id); return; }
  if(h.startsWith('admin')){ showAdmin(); return; }
  showHome(); renderList();
}
window.addEventListener('hashchange', handleHash);
window.addEventListener('load', ()=>{ renderList(); handleHash(); });

// ---------- admin functions ----------
const adminList = document.getElementById('admin-list');
function renderAdminList(){
  adminList.innerHTML='';
  products.slice().reverse().forEach(p=>{
    const row = document.createElement('div');
    row.className='bg-gray-900 p-3 rounded flex items-center justify-between gap-3';
    row.innerHTML = `
      <div>
        <div class="font-semibold">${p.name}</div>
        <div class="text-xs opacity-70">${p.type==='free'? 'مجاني' : 'مدفوع'} — ${p.price||''}</div>
      </div>
      <div class="flex gap-2">
        <button class="edit-btn px-2 py-1 rounded bg-blue-600" data-id="${p.id}">تعديل</button>
        <button class="toggle-btn px-2 py-1 rounded bg-gray-700" data-id="${p.id}">${p.hidden? 'إظهار' : 'إخفاء'}</button>
        <button class="del-btn px-2 py-1 rounded bg-red-600" data-id="${p.id}">حذف</button>
      </div>
    `;
    adminList.appendChild(row);
  });
  // events
  document.querySelectorAll('.del-btn').forEach(b=> b.onclick = (e)=>{ const id = e.target.dataset.id; if(confirm('حذف المنتج؟')){ products = products.filter(x=>x.id!=id); saveProducts(products); renderAdminList(); renderList(); } });
  document.querySelectorAll('.toggle-btn').forEach(b=> b.onclick = (e)=>{ const id=e.target.dataset.id; const p = products.find(x=>x.id==id); p.hidden = !p.hidden; saveProducts(products); renderAdminList(); renderList(); });
  document.querySelectorAll('.edit-btn').forEach(b=> b.onclick = (e)=>{ const id = e.target.dataset.id; const p = products.find(x=>x.id==id); fillForm(p); });
}

function fillForm(p){
  document.getElementById('field-id').value = p.id;
  document.getElementById('field-name').value = p.name;
  document.getElementById('field-desc').value = p.description;
  document.getElementById('field-img').value = p.image;
  document.getElementById('field-type').value = p.type;
  document.getElementById('field-price').value = p.price;
  document.getElementById('field-download').value = p.download;
  document.getElementById('field-wa').value = p.whatsapp;
}
function fillFormEmpty(){
  document.getElementById('field-id').value = '';
  document.getElementById('field-name').value = '';
  document.getElementById('field-desc').value = '';
  document.getElementById('field-img').value = '';
  document.getElementById('field-type').value = 'free';
  document.getElementById('field-price').value = '';
  document.getElementById('field-download').value = '';
  document.getElementById('field-wa').value = '';
}

// form submit
const adminForm = document.getElementById('admin-form');
adminForm.addEventListener('submit', (e)=>{
  e.preventDefault();
  const id = document.getElementById('field-id').value || (new Date()).getTime();
  const item = {
    id: id,
    name: document.getElementById('field-name').value,
    description: document.getElementById('field-desc').value,
    image: document.getElementById('field-img').value,
    type: document.getElementById('field-type').value,
    price: document.getElementById('field-price').value,
    download: document.getElementById('field-download').value,
    whatsapp: document.getElementById('field-wa').value
  };
  // if exists update
  const exists = products.find(x=>x.id==id);
  if(exists){
    products = products.map(x=> x.id==id? item : x);
  } else {
    products.push(item);
  }
  saveProducts(products); renderAdminList(); renderList(); fillFormEmpty(); alert('تم الحفظ');
});

document.getElementById('clear-form').onclick = fillFormEmpty;

// import sample
document.getElementById('btn-import').onclick = ()=>{ if(confirm('استيراد عينات؟ هذا سيستبدل المنتجات الحالية')){ products = SAMPLE.slice(); saveProducts(products); renderList(); renderAdminList(); alert('تم الاستيراد'); } }

// back button
document.getElementById('back-home').onclick = ()=>{ location.hash=''; }

</script>
</body>
</html>
